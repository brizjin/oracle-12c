1.Назначение VFS (Virtual File System - виртуальная файловая система).

VFS - пакет, позволяющий работать с данными, хранимыми в BLOB полях ORACLE,
по аналогии с файловыми операциями.


2.Установка VFS

Под именем пользователя-владельца схемы IBSO нужно выполнить из-под SQL*Plus скрипт c_all.sql.


3.

3.1.Основные понятия
Хранилища. Ближайшая аналогия - раздел жесткого диска. Физически - раздел в таблицы с данными файлов.
Основное отличие - файлы в одном каталоге могут помещаться в разных хранилищах.
Одно из них используется по умолчанию.
При создании файла, если хранилище не указано явно, берется хранилище родительского каталога.
При создании корневого каталога - используется хранилище по умолчанию.
Хранилище может быть удалено, если оно пусто и не назначено к использованию по умолчанию.
Для работы с хранилищами (создание, удаление...) нужны привилегии. по умолчанию такими правами обладают
пользователь - владелец схемы IBSO и администраторы. Можно дать персональные привилегии
пользователю либо группе.

Каталоги и файлы ведут себя примерно так же, как в обычной файловой системе.
Доступ определяется на уровне каждого элемента.
Проверка прав доступа производится в следующем порядке:
1.Владелец схемы и администраторы имеют доступ ко всем объектам.
2.Владелец объекта имеет полный доступ на него.
3.Права "для всех" (others_access) - определяют доступ по умолчанию для любого пользователя
4.Конкретным пользователям или группам может быть предоставлен персональный доступ (subject_access)
Для изменения структуры каталогов флаг FIO_MAKE_DIR в профиле пользователя должен быть установлен в YES.

Временные каталоги. Для них устанавливается время жизни. Файлы, со времени последнего изменения которых прошло
больше времени, чем установлено, удаляются. Для этого есть функция remove_temporary$ пакета vfs_mgr.

3.2.Пакеты

vfs_mgr - основной пакет для работы с каталогами и файлами
vfs_storage_mgr - пакет для работы с хранилищами
vfs_admin - все функции установки и проверки привилегий
vfs_io - оболочка над vfs_mgr и fio, предоставляющая интерфейc для
   пакета stdio (общего интерфейсного пакета функций ввода-вывода).


4. Настройки профилей пользователя.

4.1. Общие настройки.

DEFAULT_FILE_SYSTEM - Выбор файловой системы по умолчанию.
        Возможные значения:
        'FIO' - использование файловой системы сервера напрямую,
        'VFS' - использование виртуальной файловой системы.
	Если в собственном профиле настройка отсутствует, то она берется
	из умолчательного профиля DEFAULT. Если настройка отсутствует,
        то по умолчанию используется значение 'FIO'.
    Использование объектов VFS или FIO также может быть указано явно
с помощью префиксов, соответственно, 'VFS:' или 'FIO:', которые следует
указывать в именах файлов, каталогов, переменных окружения, передаваемых
в качестве параметров в процедуры и функции файлового ввода-вывода
(пакетов stdio/vfs_io).

FILE_ALIAS - Список алиасов-префиксов для замены в именах каталогов
        или файлов в формате (разделитель ';'):
        '<SEARCH_PREFIX1>=<REPLACE_PREFIX1>;<SEARCH_PREFIX2>=<REPLACE_PREFIX2>'
    Замена действует по аналогии c парами значений
FIO_REPLACE_DIR=FIO_HOME_DIR, VFS_REPLACE_DIR=VFS_HOME_DIR,
т.е. если имя файла начинается с заданного значения слева от равенства
(например, '<SEARCH_PREFIX1>'), то этот префикс заменяется на заданный
префикс справа от равенства (на '<REPLACE_PREFIX1>', соответственно).
К списку алиасов-префиксов собственного профиля в конец добавляется также
и список алиасов-префиксов умолчательного профиля DEFAULT.


4.2. Собственные настройки VFS (действуют во многом аналогично настройкам FIO).
Все настройки, если не указано явно другое поведение, наследуют значения профиля
DEFAULT, т.е. если в собственном профиле настройка отсутствует, то она берется
из умолчательного профиля DEFAULT (который, в свою очередь, назначается
по умолчанию всем пользователям, у которых нет явно указанного профиля).

VFS_PATH_SEPERATOR - Разделитель имен каталогов в именах файлов.
        Возможные значения - '/','\'.
        Если не задан, то по умолчанию используется обратный слэш - '/'.

VFS_CASE_SENSITIVE - Признак чувствительности к регистру имен файлов.
        Возможные значения - 'YES','NO'.
        Если не задан, то по умолчанию используются case-sensitive имена.

VFS_CHARSET - Кодировка интерпретации хранимых в БД данных файлов.
        Возможные значения - 'RU8PC866' (DOS-кодировка), 'CL8ISO8859P5'
        (INIX-кодировка), 'CL8MSWIN1251' (WIN-кодировка), 'CL8KOI8R'
        (KOI8-кодировка).
        Если не задан, то по умолчанию используется кодировка сервера БД.

VFS_SILENT_OVERWRITE - Признак перезаписи файла при создании,
        переименовании или копировании, если файл уже существует.
        При значении 'YES' существующий файл безусловно перезаписывается,
        при значении 'NO' существующий файл не перезаписывается,
        а функции создания, переименования или копирования возращают ошибку.

VFS_LOG_FILE	- Файл журнала файловых операций, указывается
	полное имя файла (включая путь от корня), в него записывается
	информация, соответствующая установленному уровню отладки
	DEBUG_LEVEL, степень подробности возрастает с возрастанием
        значения уровня отладки (значение 0 отключает журналирование).
        Если имя не задано, то по умолчанию пишется файл с именем
        vfs.log в корневом каталоге пользователя (в VFS_ROOT_DIR).

VFS_HOME_DIR	- Префикс имен каталогов настроек VFS (VFS_ROOT_DIR, VFS_BASE_DIR),
	т.е. указанный префикс автоматически добавляется ко всем именам
	каталогов, перечисляемым в настройках VFS_BASE_DIR и VFS_ROOT_DIR.

VFS_REPLACE_DIR	- Префикс имен каталогов, заменяемый на VFS_HOME_DIR при вызове
	функций VFS, т.е. указанный префикс автоматически замещается на VFS_HOME_DIR
	во всех функциях VFS, где используются параметры - имена каталогов или файлов.

VFS_ROOT_DIR	- Корневой каталог VFS (текущая директория), доступ
	к файлам проверяется от указанного каталога в режиме true проверки
        имен каталогов (параметр p_chk файловых операций пакета STDIO).

VFS_BASE_DIR	- Доступные каталоги VFS (разделенные ':' или ';'), доступ
	к файлам проверяется по совпадению с одним из указанных в списке каталогов
	в режиме false проверки имен каталогов (параметр p_chk файловых операций
	пакета STDIO). При указании имени '<CHECK_ROOT>' в списке каталогов будет
	включен доступ ко всему дереву подкатологов корневого каталога VFS_ROOT_DIR.
	Помимо '<CHECK_ROOT>' можно также задать список дополнительных каталогов.
	Если имя каталога оканчивается на слэш, то доступ также дается на все
	подкаталоги от указанного до слэша. К списку каталогов собственного профиля
	в конец добавляется также и список каталогов умолчательного профиля DEFAULT.

VFS_MAKE_DIR	- Флаг блокировки функций создания каталогов, если настройка равна
	'YES', то функции создания каталогов будут доступны, если значение другое или
	настройка отсутствует, то функции создания каталогов будут блокированы.

VFS_DEBUG_LEVEL	- Уровень журналирования VFS, определяет степень подробности
	журналируемой информации.

    Можно добавлять другие настройки с префиксом VFS_, они автоматически
будут записаны в переменные окружения VFS.

