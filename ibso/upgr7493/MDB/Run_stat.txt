	Порядок установки.

1. Перед установкой хранилища должен быть остановлен асинхронный
сбор статистики, т.е. выполнение операции JOB из ТБП RUN_SESSIONS.
Если операция активна, то ее выполнение нужно остановить
операцией RUN_SESSIONS.STOP. Краткое описание операций см. ниже.
2. Через АРМ "Администратор проектов" (PICK) нужно зайти на схему,
отметить элементы по списку DelObj.pck и удалить отмеченные элементы
модели.
3. Установить все типы из хранилища run_stat42.mdb.
4. Если тип использовался ранее, то нужно выполнить конвертацию
существующих данных операцией RUN_SESSIONS.CONV (в Навигаторе),
либо просто удалить данные операцией RUN_SESSIONS.CLEAR. Операция
конвертации также производит однократное преобразование единицы
измерения времени выполнения действий из минут в секунды.
5. Выполнить операцию настройки RUN_SESSIONS.SETUP в Навигаторе.
Достаточно просто запустить ее и нажать на кнопку OK.
6. Рекомендуется также выполнить синхронизацию данных со словарем IBSO
с помощью операции RUN_SESSIONS.SYNC.
7. В АРМе "Администратор словаря данных" проконтролировать
следующее:
- валидность индекса IDX_Z#RUN_STATISTICS_COLL_STAT в типе RUN_STATISTICS.
  Если индекс не существует (а такое может быть, если тип использовался
  ранее и данные до конвертации не позволили построить этот индекс),
  то его нужно создать.
- валидность представления VW_CRIT_RUN_STATISTICS_ALL в типе RUN_SESSIONS.
  Если представление не существует (а такое может быть, если тип использовался
  ранее и данные до конвертации не позволили создать это представление),
  то его откомпилировать.
8. Нужно пересоздать представления для Навигатора. Это можно сделать
двумя способами:
- в АРМе "Администратор словаря данных" выполнить пункт меню "Словарь -
  Утилиты - Пересоздание представлений".
- через SQL*Plus под владельцем IBSO выполнить команду:
  exec sviews.create_all_sviews

	
        Краткое описание типов и операций.

Типы, объединяемые общим термином "Статистика", предназначены для сбора 
и анализа статистики о запусках операций, заданий, отчетов, выборок из представлений 
(которые терминологически обозначаются понятием "действие").

Основной тип - RUN_SESSIONS, который содержит основной функционал
(операции и представления). Экземпляры типа - это отслеживаемые
сессии пользователей, для которых собирается статистика, создаются
и удаляются автоматически.

Статистика может собираться в двух режимах:
1. Асинхронно. Статистика собирается операцией JOB, которая выполняется
как задание по расписанию (JOB ORACLE). При выполнении сканирует список
сессий и отслеживает их активные состояния в привязке к выполняемому
действию (которое указывается в поле ACTION системного представления
V$SESSIONS), по завершении активности сессии фиксирует запуск действия
в типах RUNS, RUN_STATISTICS. Асинхронный сбор сохраняет любые действия,
которые удалось засечь в качестве активных хотя бы на протяжении двух
отсечек времени (справочник RUN_STAT_KIND не используется).
2. Синхронно. Статистика собирается при запуске и выполнении операций и
представлений, осуществляемых модулем Навигатор, а также при выполнении заданий
по расписанию (ТБП SYSTEM_JOBS). При заданном опциональном сборе статистик 
(значении системного параметра STATS_COLLECTING = OPTIONAL) набор действий, 
по которым осуществляется сбор статистик, задается справочником-регламентом 
RUN_STAT_KIND - "[RS] Отслеживаемые действия при сборе статистики".

Статистика по отчетам собирается в следующих режимах:
1.Запуск отчетов двухуровневым Навигатором осуществляется в асинхронном режиме,
поэтому, операция JOB должна выполняться как задание по расписанию для фиксации
выполнения отчетов.
2. Отчеты, выполняемые трехуровневым Навигатором через сервер отчетов,
фиксируются в синхронном режиме. Для более точной фиксации статистик,
выполняемых через сервер отчетов, шаблоны таких отчетов должны содержать
предопределенную точку входа (процедуру finit_session).

Статистика запусков действий может собирать следующую информацию:
1. Общая статистика - отслеживается время выполнения действий с точностью
до секунд, а также отслеживается набор общих статистических показателей
(собираемых по системным представлениям V$SESSTAT и V$STATNAME). Набор
статистических показателей регламентируется типом RUN_STAT_ENABLED, который
заполняется и управляется операцией SETUP (Настройка).
2. Точная статистика - отслеживается время выполнения действий с точностью
до сотых долей секунд, а также опционально могут отслеживаться статистические
показатели (RUN_STAT_ENABLED), которые должны быть отмечены отдельным признаком
сбора для точной статистики. Точная статистика в асинхронном режиме не собирается.
3. Расширенная статистика - включает в себя сбор общей статистики, а также
дополнительно отслеживает статистические показатели событий ожиданий
(собираемых по системным представлениям V$SESSION_EVENT и V$EVENT_NAME).
Отслеживается общий счетчик ожиданий - TIME_WAITED.
4. Трассировка выполнения действий средствами Oracle (Oracle sql-trace).
При формировании trace-файла на сервере в его имя добавляется суффикс
следующего формата: 
  '<ID запуска>_<ID сессии>', где: 
   <ID запуска> - значение ссылки на группу запуска ([RUN_GROUPS]) 
                  выполненного действия,
   <ID сессии>  - идентификатор пользовательской сессии, выполнившей
                  оттрассированное действие.

Чтобы выполнялся асинхронный сбор статистики нужно выполнить операцию
START (Запуск сбора статистики). Она запрашивает период сканирования списка
пользовательских сессий в секундах и имя отладочной пайпы, создает экземпляр
SYSTEM_JOBS для операции JOB и ставит ее в очередь.

В операции SETUP (Настройка) можно задать набор статистических показателей,
собираемых при выполнении действий. Эти показатели подразделяются на два
типа - общие счетчики (V$STATNAME) и счетчики ожиданий (V$EVENT_NAME),
которые сохраняются в регламенте RUN_STAT_ENABLED совместно с признаками
сбора этих счетчиков при выполнении действий.
При первичной установке ТБП "Статистика" регламент статистических показателей
пуст, и он заполняется при выполнении операции. В операции также есть кнопка
"По умолчанию", при ее нажатии отмечается минимальный набор полезных показателей.
Операция также настраивает следующие системные параметры (в SETTINGS):
STATS_VERSION - текущая версия используемой статистики (при переходе на новую
    версию рекомендуется выполнить операцию SETUP, чтобы обновить эту настройку).
STATS_ASYNCHR_DISABLED - при значении параметра YES отключает асинхронный
    сбор статистики, кроме асинхронного сбора статистики по отчетам, запускаемым
    в двухуровневом режиме.
STATS_COLLECTING - параметр определяет действия, по которым собирается статистика
    в синхронном режиме:
    ALL  - статистика собирается для любых действий, при этом параметр STATS_COLLECT_WAITS
         задает какая именно - общая или расширенная - статистика собирается (точная
         статистика в режиме ALL не собирается).
    NONE - статистика не собирается ни для каких действий,
    OPTIONAL - отслеживаемые действия при сборе статистики задаются справочником
         RUN_STAT_KIND, в котором дополнительно задается тип собираемой статистики
         (общая/точная/расширенная/трассировка).
STATS_COLLECT_WAITS - параметр определяет режим сбора статистики по ожиданиям
         (расширенной статистики) при установленном значении ALL параметра STATS_COLLECTING.
         Значение YES - включен сбор расширенной статистики, NO - включен сбор только
         общей статистики.
STATS_COLLECT_PRECISE - параметр включает (YES) или отключает (NO) сбор статистических
         счетчиков при сборе точной статистики. При включенном значении набор статистических
         счетчиков определяется регламентом RUN_STAT_ENABLED, причем отдельным признаком
         для точной статистики.

Операция STOP(Остановка сбора статистики) удаляет операцию JOB из очереди заданий,
т.е. останавливает асинхронный сбор статистики.

Операция CLEAR(Удаление статистики) удаляет все экземпляры RUN_SESSIONS, RUNS,
RUN_STATISTICS, RUN_PREC, RUN_STAT_PREC, т.е. очищает всю собранную статистику.

Операция CLEAR_SES(Удаление сессий) удаляет экземпляры, которые отсутствуют
в списке сессий V$SESSION.

Операция STATS_TUNING (Корректировка статистики) отмечает некоторые (аномальные)
экземпляры RUNS как некорректные.

Операция SYNC (Синхронизация данных) синхронизирует описания действий в словарях
"Группы запусков"(RUN_GROUPS) и "Отслеживаемые действия при сборе статистики"
(RUN_STAT_KIND) с текущим состоянием словаря IBSO. Также операция синхронизирует
справочник статистических показателей "Собираемая статистика" (RUN_STAT_ENABLED)
с системными справочниками V$STATNAME и V$EVENT_NAME.

Операция CONV (Конвертация данных) конвертирует данные статистики из старого
формата в новый. Рекомендуется однократное выполнение, если тип "Статистика"
использовался для сбора статистики в старом формате, т.е. если версия
использованного для этого типа была ниже, чем 4.0.

Саму статистику можно посмотреть в представлении "Статистика" (VW_CRIT_RUN_STATISTICS).
У представления есть фильтр, который запрашивает даты начала и конца периода, за
который необходимо посмотреть статистику. Если конечная дата не задана, тогда принимается
значение начала следующего дня от текущей даты. Если начальная дата не задана, тогда
принимается значение на 30 дней раньше конечной даты. Также в фильтре можно задать тип
показываемой статистики:
    1) Корректные записи - показывает сгруппированные записи из RUNS, которые операция
       STATS_TUNING сочла корректными. Чтобы что-нибудь увидеть в этом представлении,
       когда включен режим "Корректные записи", нужно выполнить операцию корректировки
       статистики.
    2) Корректные + непонятные - часть данных STATS_TUNING считает "непонятными", т.е.
       у нее недостаточно информации, чтобы отнести их к одной из категорий:
       корректные, некорректные.
    3) Все записи - Можно посмотреть необработанные данные.
Для просмотра данных по видам статистик нужно перейти (провалиться) по ссылке
из любой ссылочной колонки. Операция в пользовательском контексте сохраняет
последние введенные значения для дат, и они могут быть использованы заново.

В представлении "Статистика (все записи)" (VW_CRIT_RUN_STATISTICS_ALL)
находится все, что в VW_CRIT_RUN_STATISTICS в режиме все записи. В этом представлении
развернуты 3 основных статистики из V$SESSTAT.

Представление "Точная статистика" (VW_CRIT_RUN_STATS_PREC) аналогично по структуре
с представлением "Статистика" (VW_CRIT_RUN_STATISTICS), показывает информацию по
точной статистике.

Функции сбора статистики могут также использоваться в пользовательских
операциях, для чего выделен специальный интерфейс:
1. Глобальные описания операции SET_RUN.
2. Интерфейс точной статистики - библиотека RLIB.
Описания функций и процедур - в самих операциях.


        Остальные операции и представления - служебные.

DELETE_SPECIAL (Удаление записи (служебная)) - Точечное удаление записей статистик.

VW_CRIT_RUN_SESSIONS - "Отслеживаемые сессии":
    Список сессий, обрабатываемых заданием по сбору статистики (JOB) и отчетов.

VW_CRIT_RUN_SESSIONS_FIXED - "Зафиксированные запуски":
    Список фиксированных запусков общей и расширенной статистик.

VW_CRIT_RUN_PREC_FIXED - "Зафиксированные точные запуски":
    Список фиксированных запусков точной статистики.



        Другие типы (служебные):


RUN_STAT_KIND - "Отслеживаемые действия при сборе статистики"
  Тип представляет собой справочник-регламент списка
  операций и представлений, по которым производится
  сбор статистики при выполнении из Навигатора и через
  механизм заданий по расписанию (SYSTEM_JOBS) в режиме
  опционального сбора статистики.

RUN_STAT_ENABLED - "Собираемая статистика"
  Справочник собираемых статистических показателей
  при выполнении действий (запусках операций, представлений,
  отчетов, заданий по расписанию).

RUN_GROUPS - "Группы запусков"
  Определяет набор выполняемых действий, по которым собирается статистика.

RUNS - "Зафиксированные запуски"
  Хранит информацию о фиксированных запусках обычной и расширенной статистик.

RUN_PREC - "Точная статистика"
  Хранит информацию о фиксированных запусках точной статистики.

RUN_STAT_PREC - "Статистика запусков (точная)"
  Хранит детализированную информацию о фиксированных запусках точной статистики
  (входит как массив в тип RUN_PREC) .

RUN_STATISTICS - "Статистика запусков"
  Хранит информацию о запусках пользовательских
  действий (операций, представлений, заданий и отчетов)
  с детализацией отдельных статистик и ожиданий.
  Входит как массив в типы RUNS и RUN_STAT_PREC.

