Процедура переноса экспортного файла содержащего схему пользователя-
владельца Интегрированой Банковской Системы ( IBSO )
состоит из следующих этапов:


*******************************************************************************
  Подготовка схемы
*******************************************************************************

Создание на экземпляре новой схемы пользователя-владельца производится
запуском сценария init1.sql пользователем с правами DBA (например,SYS).
Перед запуском сценария нужно проверить и при необходимости изменить настройки 
в файле _usr_sets.sql, после чего переименовать его в usr_sets.sql.

Раздача полномочий и создание схем поддержки IBSO (схемы-ревизора AUD
и менеджера аудита AUDM) производится запуском FIRST.BAT из соответсвующей
версии UPGRADE ТЯ IBSO (5.3 и выше) с указанием коннект-строки к схеме SYS 
и к схеме AUD (если схема AUD создается, ей устанавливается пароль AUD).


*******************************************************************************
  Импорт
*******************************************************************************

Произвести импорт схемы владельца из дампа. При переносе с разными именами 
схем исходной и вновь создаваемой необходимо настроить импорт из дампа 
таким образом, чтобы не переносилась информация о грантах. Например,
если для импорта используется утилита impdp и экспортный файл содержит 
информацию о грантах, то требуется указать параметр импорта EXCLUDE=GRANT.

После окончания импорта нужно рестартовать экземпляр БД.
Если при импорте возникла ошибка ORA-02304, нужно пересоздать объектные типы 
скриптом utils\cls_tab.sql. 


При смене кодировки базы рекомендуется установить соответствующее значение 
для системного параметра DEF_TEXT. Правильное значение системного параметра 
DEF_TEXT важно для последующей установки лицензионной информации (см. п.8).
Установка значения системного параметра DEF_TEXT производится с помощью  
сценария utils\set_deft.sql, при запуске которого требуется указать значение параметра,
возможные варианты значений: UNIX, WIN (достаточно указать первый символ, 
т.е. U или W).

Выполнить complete refresh материализованных представлений при помощи сценария utils\cmviews.sql, 
для ТЯ версий >=7.4.5.4. Cценарий выполняется под SYS.

*******************************************************************************
  Действия при смене версии Oracle
*******************************************************************************

1. Если схема владельца не переименовывается, для версий ТЯ 7.0. и выше  
   нужно пересоздать пакет INST_INFO. Сценарий, создающий пакет INST_INFO - init.sql - 
   находится в подкаталоге PACKAGES соответствующей версии UPGRADE ТЯ IBSO. 
   Этот сценарий выполняется под пользователем-владельцем. 

   В противном случае (при переименовании схемы) нужно выполнить следующие действия
   (под пользователем-владельцем):
   - Выполнить процедуру exec after_install.create_diarys('1');
   - Пересоздать пакеты ядра под новое имя владельца. 
     Для этого нужно запустить kernpkg.sql из директории PACKAGES соответсвующей 
     версии UPGRADE ТЯ IBSO. 
   - Пересоздать системные преставления скриптом utils\objs.sql. При запуске скрипт 
     попросит задать имя коммуникационного канала.
   - Запустить скрипт MANUAL.SQL.

2. Выполнить полный UPGRADE ТЯ в режиме компиляции (сценарий UPGR_.BAT). 
 


*******************************************************************************
  Действия без смены версии Oracle 
*******************************************************************************

------------------------------------------------------------------------------
В случае переименования схемы нужно выполнить следующие действия 
(все запускается под пользователем-владельцем):
------------------------------------------------------------------------------
   
  1. Выполнить процедуру exec after_install.create_diarys('1');

  2. Пересоздать пакеты ядра под новое имя владельца. 
     Для этого нужно запустить kernpkg.sql из директории PACKAGES соответсвующей 
     версии UPGRADE ТЯ IBSO. 
     Пересоздать системные преставления скриптом utils\objs.sql. 
     При запуске скрипт попросит задать имя коммуникационного канала.


  3. Восстановление всех служебных представлений и полномочий на необходимые 
     для работы объекты производится запуском сценария MANUAL.SQL. 


  4. Для версий ТЯ 6.6. и выше требуется с помощью АРМа "Администратор дистрибутива"
     установить лицензионную информацию (список уполномоченных лиц, 
     лицензия на использование системы, описание приложений).

  5. В случае переименования схемы владельца нужно пересоздать интерфейсные пакеты. 
     Для этого нужно запустить скрипт COMPILE.BAT из каталога COMPILE соответствующей
     версии UPGRADE ТЯ IBSO с указанием коннект-строки к схеме-владельцу и 
     вида компиляции (10).
        
        
  6. Выполнить пересоздание прикладных представлений при помощи сценария utils\cviews.sql, 
     для ТЯ версий >=6.6. Данное действие можно выполнить только после установки 
     лицензионной информации. Cценарий выполняется под пользователем-владельцем.

  7. Если в схеме присутствуют инвалидные объекты, привести их в нормальное 
     состояние можно сценарием utils\c_obj.sql. Этот сценарий выполняется под 
     пользователем-владельцем.

  8. Вновь созданную схему-владельца необходимо перерегистрировать в схеме
     менеджера аудита (AUDM) с помощью выполнения сценария AUDM.SQL либо под
     самим менеджером аудита, либо под пользователем SYS.

  9. Установить патч версии ТЯ, если таковой имеется (сценарий PATCHX.BAT 
     подкаталога PATCH от UPGRADE соответствующей версии ТЯ).


-------------------------------------------------------------------------------
Если переименования схемы не было, нужно выполнить следующие действия 
(все запускается под пользователем-владельцем):
------------------------------------------------------------------------------

  1. Восстановление всех служебных представлений и полномочий на необходимые 
     для работы объекты производится запуском сценария MANUAL.SQL. 

  2. Для версий ТЯ 6.6. и выше требуется с помощью АРМа "Администратор дистрибутива"
     установить лицензионную информацию (список уполномоченных лиц, 
     лицензия на использование системы, описание приложений).

  3. Выполнить пересоздание прикладных представлений при помощи сценария utils\cviews.sql, 
     для ТЯ версий >=6.6. Данное действие можно выполнить только после установки 
     лицензионной информации. Cценарий выполняется под пользователем-владельцем.

  4. Если в схеме присутствуют инвалидные объекты, привести их в нормальное 
     состояние можно сценарием utils\c_obj.sql. Этот сценарий выполняется под 
     пользователем-владельцем.


  5. Вновь созданную схему-владельца необходимо перерегистрировать в схеме
     менеджера аудита (AUDM) с помощью выполнения сценария AUDM.SQL либо под
     самим менеджером аудита, либо под пользователем SYS.

  6. Установить патч версии ТЯ, если таковой имеется (сценарий PATCHX.BAT 
     подкаталога PATCH от UPGRADE соответствующей версии ТЯ).




*******************************************************************************
Резюме
*******************************************************************************

1.  init1.sql (SYS) - создание пользователя-владельца
2.  UPGRXXX\FIRST.BAT (SYS,AUD) - создание схем поддержки AUD,AUDM и раздача
    полномочий (при всех отключенных пользователях)
3.  import
4.  Выполнить complete refresh материализованных представлений при помощи сценария utils\cmviews.sql, 
    для ТЯ версий >=7.4.5.4. Cценарий выполняется под SYS.
5.  utils\cls_tab.sql для восстановления объектных типов
    в случае переименования:
    exec after_install.create_diarys('1');
    UPGRXXX\PACKAGES\kernpkg.sql
    utils\objs.sql
6.  UPGRXXX\PACKAGES\init.sql (владелец IBSO) - для версии 7.0. и выше обязательно при смене платформы.
7.  manual.sql (владелец IBSO) 
8.  set_deft.sql - при смене кодировки базы
9.  Для версии ТЯ >=6.6. - установить лицензионную информацию (список 
    уполномоченных лиц, лицензия на использование системы, описание приложений).
10.  Если не происходит смена платформы с Oracle8i на Oracle9i или Oracle 10g:
     UPGRXXX\COMPILE\COMPILE.BAT - в случае переименования схемы пересоздание интерфейсных пакетов
     cviews.sql (владелец IBSO) - пересоздание прикладных представлений 

11. audm.sql(SYS) - перерегистрация пользователя-владельца IBSO в AUDM.

12. UPGRXXX\UPGR_.BAT - при смене платформы, 
    UPGRXXX\PATCH\PATCHX.BAT - без смены платформы.

   